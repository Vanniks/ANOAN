import telebot
import random

TOKEN = "8236249109:AAFkiU0aYJBYgY12ZwO4ZJFk1M2ZavOJbIE"
bot = telebot.TeleBot(TOKEN)

waiting_users = []
pairs = {}

@bot.message_handler(commands=['start'])
def start(message):
    bot.send_message(
        message.chat.id,
        "üëã –ü—Ä–∏–≤–µ—Ç! –ù–∞–ø–∏—à–∏ /find —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞"
    )

@bot.message_handler(commands=['find'])
def find(message):
    user_id = message.chat.id

    if user_id in pairs:
        bot.send_message(user_id, "‚ùó –¢—ã —É–∂–µ –≤ —á–∞—Ç–µ")
        return

    if waiting_users:
        partner = waiting_users.pop(0)
        pairs[user_id] = partner
        pairs[partner] = user_id

        bot.send_message(user_id, "‚úÖ –°–æ–±–µ—Å–µ–¥–Ω–∏–∫ –Ω–∞–π–¥–µ–Ω! –ü–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ")
        bot.send_message(partner, "‚úÖ –°–æ–±–µ—Å–µ–¥–Ω–∏–∫ –Ω–∞–π–¥–µ–Ω! –ü–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ")
    else:
        waiting_users.append(user_id)
        bot.send_message(user_id, "‚è≥ –ò—â–µ–º —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞...")

@bot.message_handler(commands=['stop'])
def stop(message):
    user_id = message.chat.id
    if user_id in pairs:
        partner = pairs.pop(user_id)
        pairs.pop(partner)
        bot.send_message(partner, "‚ùå –°–æ–±–µ—Å–µ–¥–Ω–∏–∫ –ø–æ–∫–∏–Ω—É–ª —á–∞—Ç")
        bot.send_message(user_id, "‚ùå –¢—ã –≤—ã—à–µ–ª –∏–∑ —á–∞—Ç–∞")
    else:
        bot.send_message(user_id, "–¢—ã –Ω–µ –≤ —á–∞—Ç–µ")

@bot.message_handler(content_types=['text'])
def chat(message):
    user_id = message.chat.id
    if user_id in pairs:
        bot.send_message(pairs[user_id], message.text)
    else:
        bot.send_message(user_id, "–ù–∞–ø–∏—à–∏ /find —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —á–∞—Ç")

bot.polling(none_stop=True)